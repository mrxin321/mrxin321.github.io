---
layout: post
category: "web"
title:  "每日回顾2017-12-5"
tags: [生命在于折腾不止]
---

随着游戏玩法的增强，计算的多量化，我们的CPU并不足以迅速的处理这些问题，而Unity给我们开放了一个接口，我们需要用它来处理大量的运算； 
我们可以把大量的处理运算的逻辑放入这个Shader中，用GPU的并行能力来计算，这里简单的说一说他的使用方式和如何把参数传入和传出。让我们像一个方法一样调用。 
首先：在Unity中我们可以创建一个ComputeShader：
点击查看原图

![图片](img/222222.jpg)

打开之后会发现一个这样的脚本：
点击查看原图

简单的介绍一下， 
1、这个#pragmakernel  Multiply 这是一个内核， 也可以称作入口。这个至少有一个！ 
这个Multiply请红线标注，很重要，我们在代码里需要用到它； 
2、接下来就是一个结构体，这个结构体是我们定义的一个结构体。我们用它来和外面的结构体相呼应。 
3、RwStructuredBuffer<VecMatpair>dataBuffer  相当于我们声明的一个可读写的变量我用C#表示：   VecMatPair[] dataBuffer； 
4、就是方法主体，跟第一条呼应，外部会调用这个类似于Main函数的方法；可以写一些简单的逻辑，给上面的变量赋值：（这里值得重点一说，这个变量又当输入又当输出，注意！）； 
这里我们的ComputeShader也就构建完成了； 
下面进行C#的编写，让其呼应，传入和输出；
点击查看原图

1、  我们需要定义一个和Shader里面呼应的结构体。 
2、  获取这个shader，我们直接拖入就OK； 
然后变量基本就完事了： 
我们看一下代码主体：
点击查看原图

除去单行符号，我们一行一行解释： 
1、  声明一个长度为15的结构体，这是我们的输入参数；（然而并用不到15个） 
2、  制定一个循环，我给他了一个赋值，都是相同的值； 
循环体里的内容跳过； 
3、  这个很重要，还记得让你们标红线的地方吗。这个就是获取这个入口的标识； 
4、  下面这个数组结构，用来最后来收取需要的5个数据； 
5、  这里是测试打印跳过； 
6、  ComputeBuffer 这个也很重要，你还需要声明一个Buffer 参数需要制定这个收取的长度，和这个数组的所有占用字节（提前计算（这里就是Float=4 因为是2个Float=8 又因为是个长度为5的数组=5*8=40 ））； 
7、  下面就是一套流程了，对，就是走走流程； 
关联这个数据结构和Shader的变量相关联； 
SetData（）把需要传入的数据送进Shader； 
接着！重点，一定要运行，第一开始我写完发现怎么都没变化，一定要运行Shader；Dispatch（）； 
最后收取返回数据（我们需要接收这40个字节的数据）； 
打印结果附图：
 点击查看原图

神经网络在我认为是能放在GPU处理的 